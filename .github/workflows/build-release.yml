name: è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€æ ‡ç­¾æ—¶è§¦å‘ï¼Œä¾‹å¦‚ v1.0.0
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½® Python ç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install PySide6 Pillow reportlab nuitka ordered-set zstandard
        
    - name: ä½¿ç”¨ Nuitka æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
      run: |
        python -m nuitka --standalone --onefile --enable-plugin=pyside6 --windows-disable-console --output-dir=dist --output-filename=figer-paper-tool.exe figer.py
        
    - name: ä¸Šä¼ æ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: figer-paper-tool-windows
        path: dist/figer-paper-tool.exe
        
  create-release:
    needs: build-windows
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/')
    
    steps:
    - name: ä¸‹è½½æ„å»ºäº§ç‰©
      uses: actions/download-artifact@v4
      with:
        name: figer-paper-tool-windows
        
    - name: åˆ›å»º Release
      uses: softprops/action-gh-release@v1
      with:
        files: figer-paper-tool.exe
        body: |
          ## ğŸ‰ è®ºæ–‡ç»„å›¾å·¥å…· ${{ github.ref_name }}
          
          ### ä¸‹è½½è¯´æ˜
          - Windows ç”¨æˆ·ï¼šä¸‹è½½ `figer-paper-tool.exe`ï¼ŒåŒå‡»è¿è¡Œå³å¯
          
          ### ä¸»è¦åŠŸèƒ½
          - ğŸ“ å¤šç§ä¸“ä¸šå¸ƒå±€æ¨¡æ¿
          - ğŸ–¼ï¸ å¯è§†åŒ–å›¾ç‰‡ç¼–è¾‘
          - ğŸ·ï¸ è‡ªåŠ¨å­å›¾æ ‡æ³¨
          - ğŸ“¤ PNG/PDF å¯¼å‡º
          
          ### ä½¿ç”¨æ–¹æ³•
          1. ä¸‹è½½ `.exe` æ–‡ä»¶
          2. åŒå‡»è¿è¡Œï¼ˆæ— éœ€å®‰è£… Pythonï¼‰
          3. å¯¼å…¥å›¾ç‰‡å¹¶é€‰æ‹©å¸ƒå±€
          4. å¯¼å‡ºä¸º PNG æˆ– PDF
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
